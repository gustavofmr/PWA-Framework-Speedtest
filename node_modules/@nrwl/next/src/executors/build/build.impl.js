"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const build_1 = require("next/dist/build");
const constants_1 = require("next/dist/next-server/lib/constants");
const path_1 = require("path");
const fs_extra_1 = require("fs-extra");
const config_1 = require("../../utils/config");
const create_package_json_1 = require("./lib/create-package-json");
const create_next_config_file_1 = require("./lib/create-next-config-file");
const fileutils_1 = require("@nrwl/workspace/src/utilities/fileutils");
try {
    require('dotenv').config();
}
catch (e) { }
function buildExecutor(options, context) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const root = path_1.resolve(context.root, options.root);
        const config = yield config_1.prepareConfig(constants_1.PHASE_PRODUCTION_BUILD, options, context);
        yield build_1.default(root, config);
        if (!fileutils_1.directoryExists(options.outputPath)) {
            fs_extra_1.mkdir(options.outputPath);
        }
        create_package_json_1.createPackageJson(options, context);
        create_next_config_file_1.createNextConfigFile(options, context);
        fs_extra_1.copySync(path_1.join(root, 'public'), path_1.join(options.outputPath, 'public'));
        return { success: true };
    });
}
exports.default = buildExecutor;
//# sourceMappingURL=build.impl.js.map