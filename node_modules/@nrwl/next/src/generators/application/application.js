"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.applicationSchematic = exports.applicationGenerator = void 0;
const tslib_1 = require("tslib");
const devkit_1 = require("@nrwl/devkit");
const normalize_options_1 = require("./lib/normalize-options");
const add_cypress_1 = require("./lib/add-cypress");
const add_jest_1 = require("./lib/add-jest");
const add_project_1 = require("./lib/add-project");
const create_application_files_1 = require("./lib/create-application-files");
const create_next_server_files_1 = require("./lib/create-next-server-files");
const set_defaults_1 = require("./lib/set-defaults");
const update_jest_config_1 = require("./lib/update-jest-config");
const init_1 = require("../init/init");
const styles_1 = require("../../utils/styles");
const add_linting_1 = require("./lib/add-linting");
const run_tasks_in_serial_1 = require("@nrwl/workspace/src/utilities/run-tasks-in-serial");
function applicationGenerator(host, schema) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const options = normalize_options_1.normalizeOptions(host, schema);
        const nextTask = yield init_1.nextInitGenerator(host, Object.assign(Object.assign({}, options), { skipFormat: true }));
        create_application_files_1.createApplicationFiles(host, options);
        create_next_server_files_1.createNextServerFiles(host, options);
        add_project_1.addProject(host, options);
        const cypressTask = yield add_cypress_1.addCypress(host, options);
        const jestTask = yield add_jest_1.addJest(host, options);
        const lintTask = yield add_linting_1.addLinting(host, options);
        update_jest_config_1.updateJestConfig(host, options);
        const styledTask = styles_1.addStyleDependencies(host, options.style);
        set_defaults_1.setDefaults(host, options);
        if (!options.skipFormat) {
            yield devkit_1.formatFiles(host);
        }
        return run_tasks_in_serial_1.runTasksInSerial(nextTask, cypressTask, jestTask, lintTask, styledTask);
    });
}
exports.applicationGenerator = applicationGenerator;
exports.applicationSchematic = devkit_1.convertNxGenerator(applicationGenerator);
//# sourceMappingURL=application.js.map